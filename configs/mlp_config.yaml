# MLP Layer Quantization Configuration
# Per-layer quantization settings for QMlp
# 구조: fc1 Linear → GELU → fc2 Linear → (Norm2에서 받음)

# ==================== Linear Layer Configurations ====================

# FC1 Linear Layer (hidden expansion: 768 → 3072)
# output_quant_enable: False (GELU 전에 별도 양자화)
mlp_fc1:
  weight:
    calibration_mode: channel_wise
    bit_type:
      bits: 8
      symmetric: True
      name: int8
    observer_type: MinmaxObserver
    quantization_method: Uniform
    percentile_alpha: 0.9995
    percentile_sigma: 0.1
    kl_bins: 2048
    enable_profiler: True
  output:
    calibration_mode: layer_wise
    bit_type:
      bits: 8
      symmetric: False
      name: int8
    observer_type: MinmaxObserver
    quantization_method: Uniform
    percentile_alpha: 0.999
    percentile_sigma: 0.2
    kl_bins: 2048
    enable_profiler: True
    output_quant_enable: False

# FC2 Linear Layer (hidden reduction: 3072 → 768)
# output_quant_enable: True (fc2 출력 양자화 통합)
mlp_fc2:
  weight:
    calibration_mode: channel_wise
    bit_type:
      bits: 8
      symmetric: True
      name: int8
    observer_type: MinmaxObserver
    quantization_method: Uniform
    percentile_alpha: 0.9995
    percentile_sigma: 0.1
    kl_bins: 2048
    enable_profiler: True
  output:
    calibration_mode: channel_wise  # channel_wise → layer_wise로 변경 (클리핑 방지)
    bit_type:
      bits: 8
      symmetric: True  # 범위가 대칭적이므로 symmetric 사용
      name: int8
    observer_type: OmseObserver
    quantization_method: Uniform
    percentile_alpha: 0.99995
    percentile_sigma: 0.1
    kl_bins: 2048
    enable_profiler: True
    output_quant_enable: True

# ==================== Activation Quantization ====================

# GELU activation output quantization (fc1 출력 후)
# GELU 출력은 asymmetric (0 이상만은 아니지만 분포가 치우침)
mlp_gelu:
  calibration_mode: channel_wise
  bit_type:
    bits: 8
    symmetric: False
    name: int8
  observer_type: OmseObserver
  quantization_method: Uniform
  percentile_alpha: 0.99995
  percentile_sigma: 0.1
  kl_bins: 2048
  enable_profiler: True
